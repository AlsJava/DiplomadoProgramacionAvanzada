package edu.aluismarte.diplomado.week7.vulnerabilities;

import edu.aluismarte.diplomado.model.week7.UploadFileResponse;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.http.ResponseEntity;
import org.springframework.mock.web.MockMultipartFile;

import java.io.InputStream;

import static org.junit.jupiter.api.Assertions.assertNotNull;

/**
 * @author aluis on 5/9/2022.
 */
class MimicFileVulnerabilityTest {

    private MimicFileVulnerability mimicFileVulnerability = new MimicFileVulnerability();

    @Test
    void uploadFile() {
        InputStream inputStream = Thread.currentThread().getContextClassLoader().getResourceAsStream("MyBadFile.png");
        assertNotNull(inputStream);
        Assertions.assertDoesNotThrow(() -> {
            MockMultipartFile mockMultipartFile = new MockMultipartFile("file", "test.png", "image/png", inputStream);
            ResponseEntity<UploadFileResponse> uploadFileResponseResponseEntity = mimicFileVulnerability.uploadFile(mockMultipartFile);
            UploadFileResponse uploadFileResponse = uploadFileResponseResponseEntity.getBody();
            assertNotNull(uploadFileResponse);
            System.out.println(uploadFileResponse);
        });
    }

    // TODO Agregar un test mostrando el archivo y ver que es maligno

}